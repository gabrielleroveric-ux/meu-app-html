<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProManager Elite - Agendamento Cliente</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5;
            --primary-light: #eef2ff;
            --secondary: #64748b;
            --bg-app: #f1f5f9;
            --card-bg: #ffffff;
            --text-dark: #0f172a;
            --radius-lg: 16px;
            --radius-md: 10px;
            --shadow: 0 10px 15px -3px rgba(0,0,0,0.05);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-app);
            color: var(--text-dark);
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        .app-container {
            width: 100%;
            max-width: 480px;
            background: var(--card-bg);
            padding-bottom: 40px;
        }
        .app-header {
            padding: 50px 24px 35px;
            background: var(--primary);
            color: white;
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
            text-align: center;
        }
        .app-header h2 { font-size: 1.7rem; font-weight: 800; margin-bottom: 5px; }
        .app-header p { opacity: 0.9; font-size: 0.95rem; }

        .tabs {
            display: flex;
            gap: 12px;
            margin: -20px 24px 20px;
        }
        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            background: var(--card-bg);
            color: var(--secondary);
            box-shadow: var(--shadow);
            transition: 0.3s;
        }
        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .content-section { display: none; padding: 0 24px; }
        .content-section.active { display: block; animation: fadeIn 0.4s ease; }

        @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }

        .form-group { margin-bottom: 20px; }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            font-size: 0.8rem;
            color: var(--secondary);
            text-transform: uppercase;
        }
        .input-wrapper {
            position: relative;
        }
        .input-wrapper i {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
        }
        input, select {
            width: 100%;
            padding: 12px 12px 12px 36px;
            border: 1px solid #e2e8f0;
            border-radius: var(--radius-md);
            font-size: 14px;
        }
        input:focus, select:focus {
            border-color: var(--primary);
            outline: none;
        }

        .horario-card {
            background: var(--card-bg);
            border: 1px solid #e2e8f0;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: var(--radius-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: 0.3s;
        }
        .horario-card:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }
        .info-hora { font-weight: 600; color: var(--text-dark); }
        .btn-agendar {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 600;
        }

        .vazio { text-align:center; color: var(--secondary); padding:40px; border: 2px dashed #e2e8f0; border-radius: var(--radius-md); }

        .modal-overlay {
            display: none;
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.5);
            align-items: center; justify-content: center; z-index: 1000;
        }
        .modal-card {
            background: var(--card-bg);
            padding: 30px;
            border-radius: var(--radius-lg);
            text-align: center;
        }
        .modal-buttons { display: flex; gap: 10px; margin-top: 20px; }
        .btn-modal { flex:1; padding: 12px; border-radius: var(--radius-md); border:none; font-weight:600; cursor:pointer; }
        .btn-confirm { background: var(--danger); color:white; }
        .btn-cancel { background: #e2e8f0; color: var(--text-dark); }
    </style>
</head>
<body>
<div class="app-container">
    <div class="app-header">
        <h2>Agendamento Online</h2>
        <p>Rápido, fácil e sem complicações</p>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('agendar')">Agendar</button>
        <button class="tab-btn" onclick="switchTab('cancelar')">Meus Agendamentos</button>
    </div>

    <div id="tab-agendar" class="content-section active">
        <div class="form-group">
            <label>Nome Completo</label>
            <div class="input-wrapper">
                <i class="fa-regular fa-user"></i>
                <input type="text" id="nomeCliente" placeholder="Ex: João Silva">
            </div>
        </div>

        <div class="form-group">
            <label>WhatsApp</label>
            <div class="input-wrapper">
                <i class="fa-brands fa-whatsapp"></i>
                <input type="tel" id="whatsappCliente" placeholder="(00) 00000-0000">
            </div>
        </div>

        <div class="form-group">
            <label>Serviço Desejado</label>
            <div class="input-wrapper">
                <i class="fa-solid fa-tag"></i>
                <select id="selectServico"></select>
            </div>
        </div>

        <div class="form-group">
            <label>Escolha a Data</label>
            <div class="input-wrapper">
                <i class="fa-regular fa-calendar"></i>
                <input type="date" id="dataFiltro" onchange="carregarHorariosDoDia()">
            </div>
        </div>

        <div id="listaHorarios"></div>
    </div>

    <div id="tab-cancelar" class="content-section">
        <div class="form-group">
            <label>Código Token</label>
            <div class="input-wrapper">
                <i class="fa-solid fa-key"></i>
                <input type="text" id="tokenCancelamento" placeholder="Ex: A1B2C3" style="text-transform: uppercase;">
            </div>
        </div>
        <button class="btn-agendar" style="width:100%; background: var(--danger);" onclick="validarCancelamento()">Verificar Agendamento</button>
    </div>
</div>

<div id="modalCancelamento" class="modal-overlay">
    <div class="modal-card">
        <i class="fa-solid fa-circle-exclamation" style="font-size: 2.5rem; color: var(--danger); margin-bottom: 15px;"></i>
        <h3>Confirmar Cancelamento?</h3>
        <p id="detalhesCancelamento"></p>
        <div class="modal-buttons">
            <button class="btn-modal btn-cancel" onclick="fecharModal()">Voltar</button>
            <button class="btn-modal btn-confirm" onclick="confirmarExclusaoFinal()">Confirmar</button>
        </div>
    </div>
</div>

<script>
    let agendamentoParaCancelar = null;

    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active'));
        event.currentTarget.classList.add('active');
        document.getElementById('tab-'+tab).classList.add('active');
    }

    function configurarDataMinima() {
        const hoje = new Date().toISOString().split('T')[0];
        const input = document.getElementById('dataFiltro');
        input.min = hoje;
        input.value = hoje;
        carregarHorariosDoDia();
    }

    function carregarServicos() {
        const servicos = JSON.parse(localStorage.getItem('servicos')) || [];
        document.getElementById('selectServico').innerHTML = servicos.map(s=>`<option value="${s.nome}|${s.valor}">${s.nome} - R$ ${s.valor}</option>`).join('');
    }

    function carregarHorariosDoDia() {
        const data = document.getElementById('dataFiltro').value;
        const agenda = JSON.parse(localStorage.getItem('agenda')) || [];
        const listaH = document.getElementById('listaHorarios');
        const disponiveis = agenda.filter(i=>i.data===data && i.status==='disponivel').sort((a,b)=>a.hora.localeCompare(b.hora));
        listaH.innerHTML = disponiveis.length ? disponiveis.map(i=>`
            <div class="horario-card">
                <div class="info-hora">${i.hora}</div>
                <button class="btn-agendar" onclick="finalizarAgendamento('${i.data}','${i.hora}')">Reservar</button>
            </div>
        `).join('') : '<p class="vazio">Sem horários disponíveis para esta data.</p>';
    }

    function finalizarAgendamento(data,hora){
        const nome = document.getElementById('nomeCliente').value.trim();
        const whatsapp = document.getElementById('whatsappCliente').value.trim();
        if(nome.split(' ').length<2){ alert("⚠️ Digite seu nome completo"); return; }
        if(whatsapp.length<14){ alert("⚠️ Informe um WhatsApp válido"); return; }
        const [servicoNome, servicoValor] = document.getElementById('selectServico').value.split('|');
        const token = Math.random().toString(36).substr(2,6).toUpperCase();
        let agenda = JSON.parse(localStorage.getItem('agenda')) || [];
        agenda = agenda.map(i=> (i.data===data && i.hora===hora) ? {...i,status:'ocupado',cliente:nome,whatsapp,servico:servicoNome,token} : i);
        localStorage.setItem('agenda',JSON.stringify(agenda));
        alert(`✅ Agendamento Realizado!\nTOKEN: ${token}`);
        carregarHorariosDoDia();
    }

    function validarCancelamento() {
        const token = document.getElementById('tokenCancelamento').value.trim().toUpperCase();
        const agenda = JSON.parse(localStorage.getItem('agenda')) || [];
        const agendamento = agenda.find(i=>i.token===token);
        if(agendamento){
            agendamentoParaCancelar = agendamento;
            document.getElementById('detalhesCancelamento').innerHTML = `Deseja cancelar o serviço de <b>${agendamento.servico}</b> no dia <b>${agendamento.data.split('-').reverse().join('/')}</b> às <b>${agendamento.hora}</b>?`;
            document.getElementById('modalCancelamento').style.display='flex';
        }else alert("❌ Token inválido ou não encontrado.");
    }

    function fecharModal(){ document.getElementById('modalCancelamento').style.display='none'; agendamentoParaCancelar=null; }
    function confirmarExclusaoFinal(){
        let agenda = JSON.parse(localStorage.getItem('agenda')) || [];
        agenda = agenda.map(i=>i.token===agendamentoParaCancelar.token ? {...i,status:'disponivel',cliente:null,whatsapp:null,token:null,servico:null} : i);
        localStorage.setItem('agenda',JSON.stringify(agenda));
        fecharModal();
        alert("✅ Cancelado com sucesso.");
        carregarHorariosDoDia();
    }

    configurarDataMinima();
    carregarServicos();
</script>
</body>
</html>
